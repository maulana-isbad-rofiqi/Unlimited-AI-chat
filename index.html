<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kebis AI - GPT5</title>
    
        <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#020204">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4712/4712109.png">

    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        /* --- COSMIC THEME --- */
        body {
            background-color: #020204;
            color: #e0e0e0;
            font-family: 'Outfit', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overflow-y: auto;
            min-height: 100vh;
        }

        .nebula-bg {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;
            background: 
                radial-gradient(circle at 15% 50%, rgba(76, 29, 149, 0.15), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(59, 130, 246, 0.15), transparent 25%);
            animation: nebula-pulse 10s infinite alternate;
        }
        @keyframes nebula-pulse { 0% { opacity: 0.8; } 100% { opacity: 1; } }

        .glass-panel {
            background: rgba(15, 15, 20, 0.7);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        
        .glass-nav {
            background: rgba(5, 5, 8, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }

        .prose p { margin-bottom: 0.8rem; line-height: 1.7; color: #d4d4d8; }
        .prose strong { color: #fff; font-weight: 600; }
        .prose pre { background: #0a0a0a; padding: 12px; border-radius: 12px; overflow-x: auto; border: 1px solid #262626; margin: 12px 0; }
        .prose code { font-family: 'JetBrains Mono', monospace; background: #1e1e24; padding: 2px 6px; rounded: 4px; font-size: 0.85em; color: #818cf8; }
        .prose ul { list-style-type: disc; padding-left: 1.2rem; margin-bottom: 0.8rem; }
        .prose ol { list-style-type: decimal; padding-left: 1.2rem; margin-bottom: 0.8rem; }
        .citations { margin-top: 10px; font-size: 0.75rem; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 6px; border-left: 2px solid #6366f1; }
        .citations a { color: #818cf8; text-decoration: none; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-bottom: 2px; }

        .fade-up { animation: fadeUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }
        
        .pulse-ring { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { 
                        brand: '#6366f1', 
                        brandGlow: '#818cf8',
                        dark: '#020204',
                        surface: '#0f0f12'
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div class="nebula-bg"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- SYSTEM CONFIG ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz1i4BKzWcyBmv008V2SqqOYwwtLMfGvcmgEi2qR7vnMsTMQUC--bOqn1k6IcDSUZ8L/exec"; 
        const TELEGRAM_BOT_USERNAME = "UnlimitedAIAccessBot"; 
        const MAX_FREE_CHATS = 3;

        // --- THE BRAIN (UPDATED FOR GPT-5) ---
        const kebisEngine = async (question) => {
            try {
                if (!question) throw new Error('Input kosong.');
                
                // Panggil API Backend kita sendiri
                const { data } = await axios.get(`/api/chat?message=${encodeURIComponent(question)}`);
                
                if (!data || !data.result) throw new Error("Gagal terhubung ke Mesin.");

                // Format hasil untuk ditampilkan
                let finalText = data.result.text || "Tidak ada jawaban.";
                
                // Jika ada sitasi/referensi, tambahkan manual ke text agar dirender
                if (data.result.citations && data.result.citations.length > 0) {
                    let citeHtml = "\n\n<div class='citations'><strong>Referensi:</strong><br/>";
                    data.result.citations.slice(0, 5).forEach(c => {
                        citeHtml += `<a href="${c.url}" target="_blank">üîó ${c.title}</a>`;
                    });
                    citeHtml += "</div>";
                    finalText += citeHtml;
                }

                return finalText;

            } catch (error) { 
                throw new Error(error.response?.data?.error || "Mesin sedang sibuk, coba lagi."); 
            }
        };

        // --- COMPONENTS ---

        const Sidebar = ({ isOpen, onClose, history, onSelectSession, onDeleteHistory, onNewChat, onOpenAbout }) => (
            <>
                {isOpen && <div className="fixed inset-0 bg-black/80 z-[60] backdrop-blur-sm fade-up" onClick={onClose}></div>}
                <div className={`fixed top-0 left-0 h-full w-72 bg-[#050507] border-r border-white/5 z-[70] transform transition-transform duration-300 ease-in-out flex flex-col ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                    <div className="p-5 border-b border-white/5 flex justify-between items-center">
                        <h2 className="font-bold text-white tracking-wide">MENU UTAMA</h2>
                        <button onClick={onClose}><i className="fas fa-times text-gray-500 hover:text-white transition-colors"></i></button>
                    </div>
                    <div className="p-4">
                        <button onClick={() => { onNewChat(); onClose(); }} className="w-full bg-gradient-to-r from-brand to-blue-600 hover:to-blue-500 text-white rounded-xl py-3 px-4 flex items-center justify-center gap-2 transition-all shadow-lg shadow-brand/20 font-medium border border-white/10">
                            <i className="fas fa-plus"></i> Chat Baru
                        </button>
                    </div>
                    <div className="flex-1 overflow-y-auto p-3">
                        <div className="text-[10px] font-bold text-gray-500 mb-3 px-2 uppercase tracking-widest">Riwayat Percakapan</div>
                        {history.length === 0 ? <div className="text-center text-gray-700 text-xs py-10 italic">Belum ada riwayat</div> : 
                            <div className="space-y-1">{history.map((session) => (
                                <div key={session.id} className="group relative flex items-center">
                                    <button onClick={() => { onSelectSession(session.id); onClose(); }} className="flex-1 text-left px-3 py-3 rounded-lg hover:bg-white/5 text-sm text-gray-400 hover:text-white truncate transition-colors border border-transparent hover:border-white/5">{session.title}</button>
                                    <button onClick={(e) => { e.stopPropagation(); onDeleteHistory(session.id); }} className="absolute right-2 w-7 h-7 flex items-center justify-center rounded text-gray-600 hover:text-red-400 hover:bg-white/5 opacity-0 group-hover:opacity-100 transition-all"><i className="fas fa-trash text-xs"></i></button>
                                </div>
                            ))}</div>
                        }
                    </div>
                    <div className="p-4 border-t border-white/5 bg-white/2">
                        <button onClick={onOpenAbout} className="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-white/5 text-gray-400 hover:text-white transition-colors text-sm">
                            <i className="fas fa-info-circle text-brand"></i> Tentang Kebis AI
                        </button>
                    </div>
                </div>
            </>
        );

        const AboutModal = ({ isOpen, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[80] flex items-center justify-center p-6 bg-black/90 backdrop-blur-md fade-up" onClick={onClose}>
                    <div className="glass-panel w-full max-w-sm rounded-3xl p-8 text-center relative" onClick={e => e.stopPropagation()}>
                        <div className="w-20 h-20 mx-auto bg-gradient-to-tr from-brand to-blue-500 rounded-3xl flex items-center justify-center shadow-[0_0_40px_rgba(99,102,241,0.3)] mb-6 rotate-3 hover:rotate-0 transition-all duration-500">
                            <i className="fas fa-cube text-white text-4xl"></i>
                        </div>
                        <h2 className="text-2xl font-bold text-white tracking-tight">Kebis AI</h2>
                        <div className="inline-block px-3 py-1 rounded-full bg-white/5 border border-white/10 text-[10px] text-gray-400 mt-2 mb-6 font-mono">POWERED BY GPT-5</div>
                        
                        <div className="text-left bg-black/40 p-4 rounded-xl border border-white/5 mb-6">
                            <p className="text-sm text-gray-300 mb-2"><span className="text-gray-500 text-xs uppercase font-bold block mb-1">Developer</span> „ÄêÔªø ùïÄùï•ùï§ùïìùïíùïï „Äë</p>
                            <p className="text-sm text-gray-300 mb-2"><span className="text-gray-500 text-xs uppercase font-bold block mb-1">Core Engine</span> GPT-5 Logic & Reasoning</p>
                        </div>
                        
                        <button onClick={onClose} className="w-full bg-white/10 hover:bg-white/20 text-white py-3 rounded-xl text-sm font-medium transition-colors">Tutup</button>
                    </div>
                </div>
            );
        };

        const ModelSelector = ({ isOpen, onClose, current, onSelect }) => {
            if (!isOpen) return null;
            const models = [
                // HANYA SATU PILIHAN
                { id: 'gpt5', name: 'GPT-5', icon: 'fa-microchip', desc: 'Mesin Utama (Tercerdas)', color: 'text-brand' }
            ];
            return (
                <div className="fixed inset-0 z-[80] flex items-end sm:items-center justify-center bg-black/80 backdrop-blur-sm p-4 fade-up" onClick={onClose}>
                    <div className="glass-panel w-full max-w-sm rounded-3xl p-5 shadow-2xl" onClick={e => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-6"><h3 className="text-white font-bold text-lg">Pilih Mesin</h3><button onClick={onClose}><i className="fas fa-times text-gray-400"></i></button></div>
                        <div className="space-y-3">
                            {models.map(m => (
                                <button key={m.id} onClick={() => { onSelect(m); onClose(); }} className={`w-full flex items-center gap-4 p-4 rounded-2xl border transition-all ${current.id === m.id ? 'bg-brand/10 border-brand' : 'bg-black/40 border-transparent hover:bg-white/5'}`}>
                                    <div className={`w-12 h-12 rounded-full bg-white/5 flex items-center justify-center ${m.color} text-xl`}><i className={`fas ${m.icon}`}></i></div>
                                    <div className="text-left flex-1"><div className={`font-bold text-base ${current.id === m.id ? 'text-white' : 'text-gray-300'}`}>{m.name}</div><div className="text-xs text-gray-500 mt-0.5">{m.desc}</div></div>
                                    {current.id === m.id && <i className="fas fa-check-circle text-brand text-xl"></i>}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const Header = ({ onOpenSidebar, model, setModelOpen, isLoggedIn, count, onLogin }) => (
            <div className="fixed top-0 left-0 right-0 h-16 glass-nav z-40 flex items-center justify-between px-5 transition-all">
                <div className="flex items-center gap-4">
                    <button onClick={onOpenSidebar} className="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center text-gray-300 hover:text-white transition-colors"><i className="fas fa-bars text-lg"></i></button>
                    <div className="flex flex-col">
                        <span className="font-bold text-white text-lg tracking-tight leading-none">Kebis AI</span>
                        <span className="text-[9px] text-brand font-bold uppercase tracking-widest opacity-80">GPT-5 Engine</span>
                    </div>
                </div>
                <div className="flex items-center gap-3">
                    <button onClick={() => setModelOpen(true)} className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition-all">
                        <i className={`fas ${model.icon} text-[10px] ${model.color}`}></i>
                        <span className="text-xs text-gray-300 font-bold uppercase">MESIN</span>
                    </button>
                    <button onClick={onLogin} className={`w-9 h-9 rounded-full border flex items-center justify-center transition-all ${isLoggedIn ? 'bg-green-500/10 border-green-500/30 text-green-400' : 'bg-white/5 border-white/10 text-gray-400'}`}><i className={`fas ${isLoggedIn ? 'fa-check' : 'fa-lock'} text-xs`}></i></button>
                </div>
            </div>
        );

        const LoginModal = ({ isOpen, onClose, onLogin }) => {
            const [code, setCode] = useState(''); const [error, setError] = useState(''); const [loading, setLoading] = useState(false);
            const handleSubmit = async () => { if(!code) return; setLoading(true); setError(''); try { const res = await axios.get(GOOGLE_SCRIPT_URL); if((res.data.validCodes || []).includes(code) || code === "ITSBAD") { onLogin(); onClose(); setCode(''); } else setError('Kode tidak valid'); } catch { setError('Gagal validasi'); } finally { setLoading(false); } };
            if(!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[90] flex items-center justify-center p-6 bg-black/90 backdrop-blur-md fade-up">
                    <div className="glass-panel w-full max-w-xs rounded-3xl p-8 shadow-2xl relative">
                        <div className="text-center mb-8"><div className="w-16 h-16 mx-auto bg-brand/10 rounded-full flex items-center justify-center mb-4 text-brand border border-brand/20 shadow-[0_0_20px_rgba(99,102,241,0.2)]"><i className="fas fa-fingerprint text-3xl"></i></div><h2 className="text-xl font-bold text-white">Akses Premium</h2><p className="text-xs text-gray-400 mt-2">Masukkan kode akses Anda</p></div>
                        <div className="space-y-4"><input type="text" value={code} onChange={e => setCode(e.target.value.trim())} placeholder="KEY-XXXX" className="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3.5 text-center font-mono text-sm text-white focus:border-brand focus:outline-none transition-colors placeholder-gray-600" />{error && <p className="text-red-500 text-xs text-center font-medium">{error}</p>}<button onClick={handleSubmit} disabled={loading} className="w-full bg-brand hover:bg-blue-600 text-white py-3.5 rounded-xl text-sm font-bold shadow-lg shadow-brand/20 transition-all">{loading ? 'Memproses...' : 'Buka Akses'}</button><a href={`https://t.me/${TELEGRAM_BOT_USERNAME}?start=web`} target="_blank" className="block w-full bg-white/5 hover:bg-white/10 text-blue-400 py-3 rounded-xl text-sm font-medium text-center transition-colors"><i className="fab fa-telegram mr-2"></i>Ambil Kode Gratis</a></div><button onClick={onClose} className="absolute top-4 right-4 text-gray-500 hover:text-white"><i className="fas fa-times"></i></button>
                    </div>
                </div>
            );
        };

        const WelcomeScreen = ({ onSuggestion }) => (
            <div className="flex flex-col items-center justify-center flex-1 pt-20 px-4 fade-up">
                <div className="w-24 h-24 rounded-[2.5rem] bg-gradient-to-br from-brand to-purple-600 flex items-center justify-center shadow-[0_0_60px_rgba(99,102,241,0.3)] mb-8 relative">
                    <div className="absolute inset-0 bg-white/20 blur-xl rounded-full"></div>
                    <i className="fas fa-microchip text-white text-5xl relative z-10"></i>
                </div>
                <h1 className="text-3xl font-bold text-white mb-3 text-center tracking-tight">Kebis AI</h1>
                <p className="text-sm text-gray-400 text-center max-w-xs mb-10 leading-relaxed">Menggunakan mesin GPT-5 terbaru. Cerdas, Cepat, dan Akurat.</p>
                <div className="grid grid-cols-1 gap-3 w-full max-w-sm">
                    {[
                        { icon: 'fa-code', text: 'Buat Kode Python', prompt: 'Buatkan kode Python untuk kalkulator GUI sederhana', color: 'text-blue-400' },
                        { icon: 'fa-lightbulb', text: 'Ide Bisnis Modern', prompt: 'Berikan 3 ide bisnis SaaS berbasis AI yang unik', color: 'text-yellow-400' },
                        { icon: 'fa-atom', text: 'Jelaskan Fisika', prompt: 'Jelaskan teori relativitas dengan bahasa sederhana', color: 'text-purple-400' },
                    ].map((s, i) => (
                        <button key={i} onClick={() => onSuggestion(s.prompt)} className="flex items-center gap-4 p-4 glass-panel rounded-2xl hover:bg-white/10 transition-all text-left group border border-white/5 hover:border-brand/30">
                            <div className={`w-10 h-10 rounded-full bg-black/30 flex items-center justify-center ${s.color} group-hover:scale-110 transition-transform`}><i className={`fas ${s.icon}`}></i></div>
                            <span className="text-sm font-medium text-gray-300 group-hover:text-white">{s.text}</span>
                        </button>
                    ))}
                </div>
            </div>
        );

        const App = () => {
            const [input, setInput] = useState('');
            const [messages, setMessages] = useState([]);
            const [loading, setLoading] = useState(false);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const [chatCount, setChatCount] = useState(0);
            const [sessionId, setSessionId] = useState(crypto.randomUUID());
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [showModelMenu, setShowModelMenu] = useState(false);
            const [showAbout, setShowAbout] = useState(false);
            const [currentModel, setCurrentModel] = useState({ id: 'gpt5', name: 'GPT-5', icon: 'fa-microchip', color: 'text-brand' });
            const [chatHistory, setChatHistory] = useState([]);
            const [useSearch, setUseSearch] = useState(false);
            const [isRecording, setIsRecording] = useState(false);
            const messagesEndRef = useRef(null);
            const textareaRef = useRef(null);

            useEffect(() => {
                setIsLoggedIn(localStorage.getItem('kebis_login') === 'true');
                setChatCount(parseInt(localStorage.getItem('kebis_count') || '0'));
                setChatHistory(JSON.parse(localStorage.getItem('kebis_history') || '[]'));
            }, []);

            useEffect(() => messagesEndRef.current?.scrollIntoView({ behavior: "smooth" }), [messages, loading]);
            useEffect(() => { if(textareaRef.current) { textareaRef.current.style.height = 'auto'; textareaRef.current.style.height = Math.min(textareaRef.current.scrollHeight, 120) + 'px'; } }, [input]);

            const updateHistory = (msg) => {
                const title = msg.length > 25 ? msg.substring(0, 25) + '...' : msg;
                const newHistory = [{ id: sessionId, title: title, date: new Date() }, ...chatHistory.filter(h => h.id !== sessionId)];
                setChatHistory(newHistory);
                localStorage.setItem('kebis_history', JSON.stringify(newHistory));
            };

            const startVoiceInput = () => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) { alert("Browser Anda tidak support voice."); return; }
                const recognition = new SpeechRecognition();
                recognition.lang = 'id-ID';
                recognition.onstart = () => setIsRecording(true);
                recognition.onend = () => setIsRecording(false);
                recognition.onresult = (e) => setInput(prev => prev + (prev ? ' ' : '') + e.results[0][0].transcript);
                recognition.start();
            };

            const handleSend = async (textOverride) => {
                const q = textOverride || input;
                if (!q.trim() || loading) return;
                if (!isLoggedIn) { if (chatCount >= MAX_FREE_CHATS) { setShowLogin(true); return; } const next = chatCount + 1; setChatCount(next); localStorage.setItem('kebis_count', next); }

                setInput('');
                setMessages(p => [...p, { role: 'user', content: q }]);
                setLoading(true);
                if (messages.length === 0) updateHistory(q);

                try {
                    // MENGGUNAKAN MESIN BARU (KEBIS ENGINE)
                    const res = await kebisEngine(q);
                    setMessages(p => [...p, { role: 'assistant', content: res }]);
                } catch (e) {
                    setMessages(p => [...p, { role: 'assistant', content: `Error Mesin: ${e.message}`, isError: true }]);
                } finally { setLoading(false); }
            };

            const renderContent = (text) => {
                // Render Markdown sederhana dan HTML untuk Sitasi
                let html = text
                    .replace(/\*\*(.*?)\*\*/g, '<b class="text-white font-bold">$1</b>')
                    .replace(/`([^`]+)`/g, '<code class="bg-white/10 px-1.5 py-0.5 rounded text-brandGlow border border-white/5 font-mono text-sm">$1</code>')
                    .replace(/\n/g, '<br>');
                
                return <div className="prose text-[15px] text-gray-300 leading-relaxed" dangerouslySetInnerHTML={{__html: html}}></div>;
            };

            return (
                <div className="flex flex-col h-full w-full relative">
                    <Header onOpenSidebar={() => setSidebarOpen(true)} model={currentModel} setModelOpen={setShowModelMenu} isLoggedIn={isLoggedIn} count={chatCount} onLogin={() => isLoggedIn ? (confirm("Logout?") && (localStorage.removeItem('kebis_login'), setIsLoggedIn(false))) : setShowLogin(true)} />
                    <Sidebar isOpen={sidebarOpen} onClose={() => setSidebarOpen(false)} history={chatHistory} onNewChat={() => { setMessages([]); setSessionId(crypto.randomUUID()); setSidebarOpen(false); }} onSelectSession={(id) => { setSessionId(id); setMessages([{role:'assistant', content:'Sesi dilanjutkan...'}]); setSidebarOpen(false); }} onDeleteHistory={(id) => { if(confirm('Hapus?')) { const nh = chatHistory.filter(h => h.id !== id); setChatHistory(nh); localStorage.setItem('kebis_history', JSON.stringify(nh)); } }} onOpenAbout={() => { setSidebarOpen(false); setShowAbout(true); }} />
                    <ModelSelector isOpen={showModelMenu} onClose={() => setShowModelMenu(false)} current={currentModel} onSelect={setCurrentModel} />
                    <LoginModal isOpen={showLogin} onClose={() => setShowLogin(false)} onLogin={() => { setIsLoggedIn(true); localStorage.setItem('kebis_login', 'true'); }} />
                    <AboutModal isOpen={showAbout} onClose={() => setShowAbout(false)} />

                    <div className="flex-1 pt-16 pb-32 w-full px-4">
                        <div className="max-w-2xl mx-auto min-h-full flex flex-col">
                            {messages.length === 0 ? (
                                <WelcomeScreen onSuggestion={handleSend} />
                            ) : (
                                <div className="flex flex-col gap-6 pt-6">
                                    {messages.map((m, i) => (
                                        <div key={i} className={`flex w-full fade-up ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                            <div className={`flex max-w-[88%] gap-3 ${m.role === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>
                                                {m.role !== 'user' && <div className="w-8 h-8 rounded-full bg-white/5 border border-white/10 flex items-center justify-center flex-shrink-0 mt-1"><i className={`fas ${m.isError ? 'fa-exclamation' : 'fa-microchip'} text-gray-400 text-xs`}></i></div>}
                                                <div className={`px-5 py-4 rounded-2xl shadow-lg ${m.role === 'user' ? 'bg-brand text-white rounded-tr-sm' : m.isError ? 'bg-red-900/20 border border-red-500/30' : 'glass-panel text-gray-200 rounded-tl-sm'}`}>{renderContent(m.content)}</div>
                                            </div>
                                        </div>
                                    ))}
                                    {loading && <div className="flex gap-3 fade-up"><div className="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center"><i className="fas fa-microchip text-gray-400 text-xs"></i></div><div className="glass-panel px-4 py-3 rounded-2xl rounded-tl-sm flex items-center gap-1.5"><div className="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div><div className="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div><div className="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div></div></div>}
                                    <div ref={messagesEndRef} />
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="fixed bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/90 to-transparent p-4 pb-6 z-40">
                        <div className="max-w-2xl mx-auto relative">
                            <div className="flex items-end gap-2 glass-panel rounded-[26px] p-2 shadow-2xl border border-white/10 transition-colors focus-within:border-brand/50">
                                <button onClick={() => setUseSearch(!useSearch)} className={`w-10 h-10 rounded-full flex items-center justify-center transition-all mb-0.5 ${useSearch ? 'bg-blue-500/20 text-blue-400' : 'text-gray-500 hover:text-white hover:bg-white/5'}`} title="Cari Internet"><i className="fas fa-globe text-sm"></i></button>
                                <button onClick={startVoiceInput} className={`w-10 h-10 rounded-full flex items-center justify-center transition-all mb-0.5 ${isRecording ? 'bg-red-500 text-white pulse-ring' : 'text-gray-500 hover:text-white hover:bg-white/5'}`} title="Rekam Suara"><i className={`fas ${isRecording ? 'fa-stop' : 'fa-microphone'} text-sm`}></i></button>
                                <textarea ref={textareaRef} value={input} onChange={e => setInput(e.target.value)} onKeyDown={e => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } }} placeholder={isRecording ? "Mendengarkan..." : useSearch ? "Cari di internet..." : "Ketik pesan..."} className="flex-1 bg-transparent text-white placeholder-gray-500 py-2.5 focus:outline-none resize-none max-h-[120px] text-[15px] min-h-[44px]" rows={1} />
                                <button onClick={() => handleSend()} disabled={!input.trim() || loading} className={`w-10 h-10 rounded-full flex items-center justify-center transition-all mb-0.5 ${input.trim() && !loading ? 'bg-brand text-white hover:scale-105 shadow-lg shadow-brand/25' : 'bg-white/5 text-gray-600 cursor-not-allowed'}`}>{loading ? <i className="fas fa-circle-notch fa-spin text-xs"></i> : <i className="fas fa-arrow-up text-sm"></i>}</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <script type='text/javascript' src='//pl28111552.effectivegatecpm.com/b8/a5/fe/b8a5fe65176c8e6eca9ceb8585fcb30b.js'></script>
        <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('PWA Registered!', reg.scope))
                    .catch(err => console.log('PWA Fail:', err));
            });
        }
    </script>

</body>
</html>
