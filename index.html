<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Unlimited AI Interface</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #09090b; color: #e4e4e7; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in-up { animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .glass-header { background: rgba(9, 9, 11, 0.8); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255, 255, 255, 0.05); }
        .glass-input { background: rgba(24, 24, 27, 0.95); backdrop-filter: blur(20px); border-top: 1px solid rgba(255, 255, 255, 0.05); }
        .glass-modal { background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(10px); }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: { colors: { brand: '#8b5cf6', brandDark: '#7c3aed', dark: '#09090b', surface: '#18181b', subtle: '#27272a' } }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- KONFIGURASI (SUDAH DIISI OTOMATIS) ---
        
        // 1. URL Script Google kamu (Sudah terisi)
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/library/d/1Fb5sMRmykXsespfeFlmu4MPNvrkz_OMj68Z4NAgpKJRncjh0NMI5UzXr/2"; 
        
        // 2. Username Bot Telegram (GANTI INI DENGAN USERNAME BOT KAMU!)
        // Contoh: "UnlimitedAIBot" (Jangan pakai @)
        const TELEGRAM_BOT_USERNAME = "UnlimitedAIAccessBot"; 

        const MAX_FREE_CHATS = 3;

        // --- LOGIKA API ---
        const unlimitedai = async (question) => {
            try {
                if (!question) throw new Error('Pertanyaan kosong.');
                
                // Menggunakan Backend Vercel (/api)
                const BACKEND_URL = "/api"; 
                
                const { data: tokenData } = await axios.get(`${BACKEND_URL}/token`);
                if (!tokenData || !tokenData.token) throw new Error("Gagal otentikasi.");
                
                const chatUuid = crypto.randomUUID();
                const msgUuid = crypto.randomUUID();
                
                const { data } = await axios.post(`${BACKEND_URL}/chat`, {
                    messages: [{
                        id: msgUuid, createdAt: new Date().toISOString(), role: 'user', content: question,
                        parts: [{ type: 'text', text: question }]
                    }],
                    id: chatUuid, selectedChatModel: 'chat-model-reasoning', selectedCharacter: null, selectedStory: null
                }, { headers: { 'x-api-token': tokenData.token } });
                
                if (typeof data === 'string') {
                    const resultLine = data.split('\n').find(line => line.startsWith('0:'));
                    if (resultLine) {
                        let cleanText = resultLine.slice(2); 
                        if (cleanText.startsWith('"') && cleanText.endsWith('"')) cleanText = cleanText.slice(1, -1);
                        try { return JSON.parse(`"${cleanText}"`); } catch (e) { return cleanText; }
                    }
                } 
                return typeof data === 'object' ? JSON.stringify(data) : data;
            } catch (error) {
                throw new Error(error.response?.data?.error || error.message);
            }
        };

        // --- KOMPONEN ---
        const LoginModal = ({ isOpen, onClose, onLogin }) => {
            const [code, setCode] = useState('');
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async () => {
                if(!code) return;
                setLoading(true);
                setError('');

                try {
                    // Cek ke Google Script apakah kode valid
                    const response = await axios.get(GOOGLE_SCRIPT_URL);
                    const validCodes = response.data.validCodes || []; 

                    // Validasi: Kode ada di database ATAU Master Key 'ITSBAD'
                    if (validCodes.includes(code) || code === "ITSBAD") {
                        onLogin();
                        onClose();
                        setCode('');
                    } else {
                        setError('Kode salah atau sudah kadaluarsa.');
                    }
                } catch (err) {
                    setError('Gagal terhubung ke server validasi.');
                    console.error(err);
                } finally {
                    setLoading(false);
                }
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 glass-modal animate-in fade-in duration-200">
                    <div className="bg-surface border border-zinc-700 w-full max-w-sm rounded-2xl p-6 shadow-2xl relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand to-blue-500"></div>
                        <div className="text-center mb-6">
                            <div className="w-12 h-12 mx-auto bg-zinc-800 rounded-full flex items-center justify-center mb-3 border border-zinc-700">
                                <i className="fas fa-shield-alt text-brand text-xl"></i>
                            </div>
                            <h2 className="text-xl font-bold text-white">Akses Member</h2>
                            <p className="text-sm text-zinc-400 mt-1">Masukkan Kunci Akses Telegram Anda.</p>
                        </div>
                        <div className="space-y-4">
                            <div>
                                <input 
                                    type="text" value={code} onChange={(e) => setCode(e.target.value.trim())}
                                    placeholder="KEY-XXXXXX"
                                    className="w-full bg-dark border border-zinc-700 rounded-xl px-4 py-3 text-center font-mono font-bold text-white focus:border-brand focus:outline-none uppercase"
                                />
                                {error && <p className="text-red-400 text-xs text-center mt-2">{error}</p>}
                            </div>
                            <button onClick={handleSubmit} disabled={loading} className="w-full bg-brand hover:bg-brandDark text-white font-medium py-3 rounded-xl shadow-lg shadow-brand/20 disabled:opacity-50 flex justify-center items-center gap-2">
                                {loading ? <><i className="fas fa-spinner fa-spin"></i> Memeriksa...</> : "Masuk"}
                            </button>
                            
                            <div className="relative my-2"><div className="absolute inset-0 flex items-center"><div className="w-full border-t border-zinc-800"></div></div><div className="relative flex justify-center text-xs uppercase"><span className="bg-surface px-2 text-zinc-500">Belum punya kode?</span></div></div>
                            
                            <a href={`https://t.me/${TELEGRAM_BOT_USERNAME}?start=web`} target="_blank" className="block w-full bg-[#24A1DE]/10 hover:bg-[#24A1DE]/20 border border-[#24A1DE]/30 text-[#24A1DE] text-center py-3 rounded-xl text-sm font-medium flex items-center justify-center gap-2">
                                <i className="fab fa-telegram text-lg"></i> Ambil Kode via Telegram
                            </a>
                        </div>
                        <button onClick={onClose} className="absolute top-3 right-3 text-zinc-600 hover:text-zinc-300"><i className="fas fa-times"></i></button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [input, setInput] = useState('');
            const [messages, setMessages] = useState([{ role: 'assistant', content: 'Halo! Selamat datang di Unlimited AI.' }]);
            const [isLoading, setIsLoading] = useState(false);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const [chatCount, setChatCount] = useState(0);
            
            const messagesEndRef = useRef(null);
            const textareaRef = useRef(null);

            // Load Session
            useEffect(() => {
                const savedLogin = localStorage.getItem('unlimited_login') === 'true';
                const savedCount = parseInt(localStorage.getItem('unlimited_count') || '0');
                setIsLoggedIn(savedLogin);
                setChatCount(savedCount);
            }, []);

            const scrollToBottom = () => messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            useEffect(() => scrollToBottom(), [messages, isLoading]);

            const handleSend = async () => {
                if (!input.trim() || isLoading) return;
                
                // Cek Login / Limit Chat
                if (!isLoggedIn) {
                    if (chatCount >= MAX_FREE_CHATS) {
                        setMessages(prev => [...prev, { role: 'assistant', content: 'üîí Limit chat gratis habis. Silakan ambil kode akses gratis di Telegram kami.', isSystem: true }]);
                        setShowLogin(true);
                        return;
                    }
                    const newCount = chatCount + 1;
                    setChatCount(newCount);
                    localStorage.setItem('unlimited_count', newCount.toString());
                }

                const q = input; setInput('');
                setMessages(p => [...p, { role: 'user', content: q }]);
                setIsLoading(true);

                try {
                    const res = await unlimitedai(q);
                    setMessages(p => [...p, { role: 'assistant', content: res }]);
                } catch (e) {
                    setMessages(p => [...p, { role: 'assistant', content: `Error: ${e.message}`, isError: true }]);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="flex flex-col h-[100dvh] bg-dark">
                    <div className="glass-header fixed top-0 w-full h-14 z-50 flex items-center justify-between px-4 md:px-6">
                        <div className="flex items-center gap-3">
                            <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-brand to-blue-500 flex items-center justify-center shadow-[0_0_15px_rgba(139,92,246,0.3)]"><i className="fas fa-bolt text-white text-xs"></i></div>
                            <h1 className="font-semibold text-lg tracking-tight text-white">Unlimited AI</h1>
                        </div>
                        <div className="flex items-center gap-3">
                            {!isLoggedIn && <div className="text-xs font-mono text-zinc-500 bg-zinc-800/50 px-2 py-1 rounded border border-zinc-700">{chatCount}/{MAX_FREE_CHATS}</div>}
                            <button onClick={() => isLoggedIn ? (confirm('Yakin ingin keluar?') && (localStorage.removeItem('unlimited_login'), setIsLoggedIn(false), setChatCount(0))) : setShowLogin(true)} className="w-8 h-8 rounded-full bg-subtle border border-zinc-700 flex items-center justify-center text-zinc-400">
                                <i className={`fas ${isLoggedIn ? 'fa-check text-brand' : 'fa-lock'}`}></i>
                            </button>
                        </div>
                    </div>
                    
                    <LoginModal isOpen={showLogin} onClose={() => setShowLogin(false)} onLogin={() => {setIsLoggedIn(true); localStorage.setItem('unlimited_login', 'true'); setMessages(p => [...p, { role: 'assistant', content: '‚úÖ Akses Member Diterima! Selamat menikmati chat unlimited.', isSystem: true }])}} />

                    <div className="flex-1 overflow-y-auto no-scrollbar pt-20 pb-4 px-4 md:px-0">
                        <div className="max-w-2xl mx-auto w-full pb-32">
                            {messages.map((m, i) => (
                                <div key={i} className={`fade-in-up flex w-full mb-6 ${m.isSystem ? 'justify-center' : m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    {m.isSystem ? <span className="bg-brand/10 text-brand text-xs px-3 py-1 rounded-full border border-brand/20"><i className="fas fa-info-circle mr-1"></i> {m.content}</span> : 
                                    <div className={`flex max-w-[85%] gap-3 ${m.role === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>
                                        {m.role !== 'user' && <div className="w-8 h-8 rounded-full bg-surface border border-zinc-700 flex-shrink-0 flex items-center justify-center mt-1"><i className="fas fa-robot text-zinc-400 text-xs"></i></div>}
                                        <div className={`px-5 py-3.5 text-[15px] rounded-2xl shadow-sm ${m.role === 'user' ? 'bg-brand text-white rounded-tr-sm' : m.isError ? 'bg-red-900/20 text-red-200 border border-red-500/30' : 'bg-surface border border-zinc-800 text-zinc-300 rounded-tl-sm'}`}>{m.content}</div>
                                    </div>}
                                </div>
                            ))}
                            {isLoading && <div className="fade-in-up flex gap-2 items-center ml-11 mb-6"><div className="flex gap-1 bg-surface border border-zinc-800 px-3 py-2 rounded-xl"><div className="w-1.5 h-1.5 bg-zinc-500 rounded-full typing-dot"></div><div className="w-1.5 h-1.5 bg-zinc-500 rounded-full typing-dot"></div><div className="w-1.5 h-1.5 bg-zinc-500 rounded-full typing-dot"></div></div></div>}
                            <div ref={messagesEndRef} />
                        </div>
                    </div>

                    <div className="glass-input fixed bottom-0 w-full pb-6 pt-4 px-4 z-40">
                        <div className="max-w-2xl mx-auto relative">
                            <div className={`flex items-end gap-2 bg-subtle/50 p-1.5 rounded-[24px] border transition-all duration-300 ${isLoggedIn ? 'border-brand/30' : 'border-zinc-700/50'}`}>
                                <textarea ref={textareaRef} value={input} onChange={e => setInput(e.target.value)} onKeyDown={e => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } }} placeholder={isLoggedIn ? "Ketik pesan..." : `Ketik pesan (Sisa: ${MAX_FREE_CHATS - chatCount})...`} className="w-full bg-transparent text-zinc-200 placeholder-zinc-500 px-4 py-3 focus:outline-none resize-none max-h-[120px] text-[15px]" rows={1} />
                                <button onClick={handleSend} disabled={!input.trim() || isLoading} className={`mb-1 mr-1 w-10 h-10 rounded-full flex items-center justify-center transition-all ${input.trim() && !isLoading ? 'bg-brand text-white' : 'bg-zinc-800 text-zinc-600'}`}>{isLoading ? <i className="fas fa-spinner fa-spin text-sm"></i> : <i className="fas fa-arrow-up text-sm"></i>}</button>
                            </div>
                            <div className="text-center mt-4 select-none"><p className="text-[10px] font-mono tracking-widest text-zinc-600 uppercase">Created by <span className="text-zinc-400 font-bold">„ÄêÔªø ùïÄùï•ùï§ùïìùïíùïï „Äë</span></p></div>
                        </div>
                    </div>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
