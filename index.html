<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Unlimited AI Interface</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #09090b; /* Zinc 950 */
            color: #e4e4e7; /* Zinc 200 */
        }
        
        /* Hide Scrollbar but keep functionality */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Animations */
        .fade-in-up { animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* Glass Effect */
        .glass-header {
            background: rgba(9, 9, 11, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .glass-input {
            background: rgba(24, 24, 27, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: '#8b5cf6', // Violet 500
                        brandDark: '#7c3aed',
                        dark: '#09090b',
                        surface: '#18181b', // Zinc 900
                        subtle: '#27272a', // Zinc 800
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- CORE LOGIC (Backend Vercel) ---
        const unlimitedai = async (question) => {
            try {
                if (!question) throw new Error('Pertanyaan kosong.');
                
                // Menggunakan Relative Path ke Backend Vercel
                const BACKEND_URL = "/api"; 

                const { data: tokenData } = await axios.get(`${BACKEND_URL}/token`);
                if (!tokenData || !tokenData.token) throw new Error("Gagal otentikasi.");

                const chatUuid = crypto.randomUUID();
                const msgUuid = crypto.randomUUID();

                const { data } = await axios.post(`${BACKEND_URL}/chat`, {
                    messages: [{
                        id: msgUuid, createdAt: new Date().toISOString(), role: 'user', content: question,
                        parts: [{ type: 'text', text: question }]
                    }],
                    id: chatUuid, selectedChatModel: 'chat-model-reasoning', selectedCharacter: null, selectedStory: null
                }, { headers: { 'x-api-token': tokenData.token } });
                
                // Parsing Logic
                if (typeof data === 'string') {
                    const resultLine = data.split('\n').find(line => line.startsWith('0:'));
                    if (resultLine) {
                        let cleanText = resultLine.slice(2); 
                        if (cleanText.startsWith('"') && cleanText.endsWith('"')) cleanText = cleanText.slice(1, -1);
                        try { return JSON.parse(`"${cleanText}"`); } catch (e) { return cleanText; }
                    }
                } 
                return typeof data === 'object' ? JSON.stringify(data) : data;
            } catch (error) {
                throw new Error(error.response?.data?.error || error.message);
            }
        };

        // --- UI COMPONENTS ---

        const Header = () => (
            <div className="glass-header fixed top-0 w-full h-14 z-50 flex items-center justify-between px-4 md:px-6">
                <div className="flex items-center gap-3">
                    <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-brand to-blue-500 flex items-center justify-center shadow-[0_0_15px_rgba(139,92,246,0.3)]">
                        <i className="fas fa-bolt text-white text-xs"></i>
                    </div>
                    <h1 className="font-semibold text-lg tracking-tight text-white">
                        Unlimited AI
                    </h1>
                </div>
                <div className="flex items-center">
                    <a href="https://github.com" target="_blank" className="text-zinc-500 hover:text-white transition-colors p-2">
                        <i className="fab fa-github text-lg"></i>
                    </a>
                </div>
            </div>
        );

        const Message = ({ role, content, isError }) => {
            const isUser = role === 'user';
            
            return (
                <div className={`fade-in-up flex w-full mb-6 ${isUser ? 'justify-end' : 'justify-start'}`}>
                    <div className={`flex max-w-[85%] md:max-w-[75%] gap-3 ${isUser ? 'flex-row-reverse' : 'flex-row'}`}>
                        {/* Avatar */}
                        {!isUser && (
                            <div className="w-8 h-8 rounded-full bg-surface border border-zinc-700 flex-shrink-0 flex items-center justify-center mt-1">
                                <i className="fas fa-robot text-zinc-400 text-xs"></i>
                            </div>
                        )}
                        
                        {/* Bubble */}
                        <div className={`group relative px-5 py-3.5 text-[15px] leading-relaxed rounded-2xl shadow-sm ${
                            isUser 
                                ? 'bg-brand text-white rounded-tr-sm' 
                                : isError 
                                    ? 'bg-red-900/20 border border-red-500/30 text-red-200 rounded-tl-sm'
                                    : 'bg-surface border border-zinc-800 text-zinc-300 rounded-tl-sm'
                        }`}>
                            <div className="whitespace-pre-wrap font-normal">{content}</div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [input, setInput] = useState('');
            const [messages, setMessages] = useState([
                { role: 'assistant', content: 'Sistem siap. Apa yang ingin dibahas?' }
            ]);
            const [isLoading, setIsLoading] = useState(false);
            const messagesEndRef = useRef(null);
            const textareaRef = useRef(null);

            const scrollToBottom = () => messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            
            useEffect(() => scrollToBottom(), [messages, isLoading]);

            // Auto resize textarea
            useEffect(() => {
                if (textareaRef.current) {
                    textareaRef.current.style.height = 'auto';
                    textareaRef.current.style.height = Math.min(textareaRef.current.scrollHeight, 120) + 'px';
                }
            }, [input]);

            const handleSend = async () => {
                if (!input.trim() || isLoading) return;
                const q = input; 
                setInput('');
                if (textareaRef.current) textareaRef.current.style.height = 'auto';

                setMessages(p => [...p, { role: 'user', content: q }]);
                setIsLoading(true);

                try {
                    const res = await unlimitedai(q);
                    setMessages(p => [...p, { role: 'assistant', content: res }]);
                } catch (e) {
                    setMessages(p => [...p, { role: 'assistant', content: `Gagal: ${e.message}`, isError: true }]);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div className="flex flex-col h-[100dvh] bg-dark">
                    <Header />

                    {/* Chat Container */}
                    <div className="flex-1 overflow-y-auto no-scrollbar pt-20 pb-4 px-4 md:px-0">
                        <div className="max-w-2xl mx-auto w-full pb-32">
                            {messages.map((m, i) => <Message key={i} {...m} />)}
                            
                            {isLoading && (
                                <div className="fade-in-up flex gap-2 items-center ml-11 mb-6">
                                    <div className="flex gap-1 bg-surface border border-zinc-800 px-3 py-2 rounded-xl">
                                        <div className="w-1.5 h-1.5 bg-zinc-500 rounded-full typing-dot"></div>
                                        <div className="w-1.5 h-1.5 bg-zinc-500 rounded-full typing-dot"></div>
                                        <div className="w-1.5 h-1.5 bg-zinc-500 rounded-full typing-dot"></div>
                                    </div>
                                </div>
                            )}
                            <div ref={messagesEndRef} />
                        </div>
                    </div>

                    {/* Input Area */}
                    <div className="glass-input fixed bottom-0 w-full pb-6 pt-4 px-4 z-40">
                        <div className="max-w-2xl mx-auto relative">
                            <div className="flex items-end gap-2 bg-subtle/50 p-1.5 rounded-[24px] border border-zinc-700/50 focus-within:border-zinc-600 focus-within:bg-subtle transition-all duration-300 ring-offset-2 ring-offset-dark focus-within:ring-2 ring-brand/20">
                                <textarea
                                    ref={textareaRef}
                                    value={input}
                                    onChange={e => setInput(e.target.value)}
                                    onKeyDown={e => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } }}
                                    placeholder="Ketik pesan..."
                                    className="w-full bg-transparent text-zinc-200 placeholder-zinc-500 px-4 py-3 focus:outline-none resize-none max-h-[120px] text-[15px]"
                                    rows={1}
                                />
                                <button 
                                    onClick={handleSend}
                                    disabled={!input.trim() || isLoading}
                                    className={`mb-1 mr-1 w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200 ${
                                        input.trim() && !isLoading 
                                        ? 'bg-brand text-white shadow-lg hover:bg-brandDark transform hover:scale-105' 
                                        : 'bg-zinc-800 text-zinc-600 cursor-not-allowed'
                                    }`}
                                >
                                    {isLoading ? <i className="fas fa-spinner fa-spin text-sm"></i> : <i className="fas fa-arrow-up text-sm"></i>}
                                </button>
                            </div>
                            
                            {/* CREATOR CREDIT */}
                            <div className="text-center mt-4 select-none">
                                <p className="text-[10px] font-mono tracking-widest text-zinc-600 uppercase">
                                    Created by <span className="text-zinc-400 font-bold">„ÄêÔªø ùïÄùï•ùï§ùïìùïíùïï „Äë</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
